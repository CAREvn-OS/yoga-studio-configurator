const i="studio-media";function c(){return null}async function f(e,n){const t=c();if(!t)return null;const r=e.name.split(".").pop()??"bin",s=Date.now(),a=`uploads/${n}_${s}.${r}`,{error:o}=await t.storage.from(i).upload(a,e,{cacheControl:"3600",upsert:!0});if(o)return console.warn("[media-storage] Upload failed:",o.message),null;const{data:u}=t.storage.from(i).getPublicUrl(a);return{path:a,url:u.publicUrl}}async function p(e){const n=c();if(!n)return;const{error:t}=await n.storage.from(i).remove([e]);t&&console.warn("[media-storage] Delete failed:",t.message)}function d(e){const n=c();if(!n)return null;const{data:t}=n.storage.from(i).getPublicUrl(e);return t.publicUrl}function l(){return null}async function g(){try{const t=(await(await fetch("https://api.ipify.org?format=json")).json()).ip,r=new TextEncoder,s=await crypto.subtle.digest("SHA-256",r.encode(t));return Array.from(new Uint8Array(s)).map(o=>o.toString(16).padStart(2,"0")).join("")}catch{return null}}async function h(e,n){const t=l();if(!t)return!1;try{const{error:r}=await t.from("configurations").upsert({ip_hash:e,config:JSON.parse(n),updated_at:new Date().toISOString()},{onConflict:"ip_hash"});return r?(console.warn("[persistence] Save failed:",r.message),!1):!0}catch{return!1}}async function m(e){const n=l();if(!n)return null;try{const{data:t,error:r}=await n.from("configurations").select("config").eq("ip_hash",e).single();return r||!t?null:t.config}catch{return null}}export{p as deleteMedia,g as getIpHash,d as getMediaUrl,m as loadConfig,h as saveConfig,f as uploadMedia};
